<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zama Demo Testnet - Single File Version</title>
<style>
body {
  margin: 0; font-family: Arial; background: #0f1724; color: #fff;
}
header {
  background:#111a2b; padding:15px; display:flex; justify-content:space-between; align-items:center;
}
button{
  padding:8px 14px; border:none; border-radius:6px; cursor:pointer; font-weight:bold;
}
#connect {background:#ffd400; color:#000;}
#faucet,#sendTx,#encryptBtn,#decryptBtn {background:#303a4a; color:#fff;}
.card{
  background:#111a2b; padding:15px; margin:20px; border-radius:8px;
}
pre{background:#000; padding:10px; height:120px; overflow:auto;}
input,textarea{
  width:100%; padding:8px; margin-top:6px; border-radius:6px; border:1px solid #333; background:#0b1220; color:white;
}
.nodeBox{display:flex; gap:8px;}
.node{
  background:#1a2438; padding:8px; border-radius:6px; width:90px; text-align:center;
}
.green{color:#00ff87;}
.red{color:#ff4d4d;}
</style>
</head>
<body>

<header>
  <h2>Zama Demo Testnet</h2>
  <button id="connect">Connect Wallet</button>
</header>

<div class="card">
  <h3>Wallet</h3>
  <p>Address: <span id="wallet">Not Connected</span></p>
  <p>Balance: <span id="balance">0</span> tZAMA</p>
  <button id="faucet">Get Test Tokens (Faucet)</button>
</div>

<div class="card">
  <h3>Encrypt / Decrypt Demo</h3>
  <textarea id="plain" placeholder="Enter text"></textarea>
  <button id="encryptBtn">Encrypt</button>
  <button id="decryptBtn">Decrypt</button>
  <pre id="encOutput">Encrypted / Decrypted output will show here</pre>
</div>

<div class="card">
  <h3>Run Transaction</h3>
  <button id="sendTx">Send Fake Transaction</button>
  <pre id="txBox">TX output will appear here</pre>
</div>

<div class="card">
  <h3>MPC Nodes</h3>
  <div class="nodeBox" id="nodes"></div>
</div>

<div class="card">
  <h3>Event Logs</h3>
  <pre id="logs"></pre>
</div>

<script>
// ------------------ WALLET ------------------
let wallet = null;
let balance = 0;
const logBox = document.getElementById("logs");

function log(msg){
  logBox.innerHTML = msg + "\\n" + logBox.innerHTML;
}

document.getElementById("connect").onclick = ()=>{
  if(wallet === null){
    wallet = "0x" + Math.random().toString(16).substr(2,8);
    document.getElementById("wallet").textContent = wallet;
    log("Wallet connected: " + wallet);
  } else {
    log("Wallet disconnected.");
    wallet = null;
    document.getElementById("wallet").textContent = "Not Connected";
  }
};

// ------------------ FAUCET ------------------
document.getElementById("faucet").onclick = ()=>{
  if(wallet === null){ alert("Connect wallet first!"); return; }
  balance += 100;
  document.getElementById("balance").textContent = balance;
  log("Faucet added 100 tZAMA to wallet.");
};

// ------------------ ENCRYPT / DECRYPT ------------------
document.getElementById("encryptBtn").onclick = ()=>{
  let text = document.getElementById("plain").value;
  if(!text){ alert("Enter text"); return; }
  let enc = btoa(text);
  document.getElementById("encOutput").textContent = enc;
  log("Encrypted text generated.");
};

document.getElementById("decryptBtn").onclick = ()=>{
  let enc = document.getElementById("encOutput").textContent;
  try{
    let dec = atob(enc);
    document.getElementById("encOutput").textContent = dec;
    log("Decrypted text generated.");
  } catch(e){
    alert("Invalid encrypted text!");
  }
};

// ------------------ TRANSACTION ------------------
document.getElementById("sendTx").onclick = ()=>{
  if(!wallet){ alert("Connect wallet"); return; }
  if(balance <= 0){ alert("Not enough balance"); return; }

  let tx = {
    hash: "0x" + Math.random().toString(16).substr(2,32),
    status: "confirmed",
    time: (Math.random()*1.5+0.5).toFixed(2) + "s"
  };

  balance -= 1;
  document.getElementById("balance").textContent = balance;
  document.getElementById("txBox").textContent = JSON.stringify(tx,null,2);
  log("Transaction sent: " + tx.hash);
};

// ------------------ MPC NODES ------------------
function loadNodes(){
  let box = document.getElementById("nodes");
  box.innerHTML = "";
  for(let i=1;i<=5;i++){
    let online = Math.random() > 0.2;
    box.innerHTML += `
      <div class="node">
        <b>Node ${i}</b><br>
        <span class="${online?'green':'red'}">
          ${online?'ONLINE':'OFFLINE'}
        </span>
      </div>`;
  }
  log("Refreshed MPC nodes.");
}
loadNodes();
setInterval(loadNodes, 5000);
</script>
</body>
</html>
