<!--
Zama Demo Testnet - Single-file HTML (No Encrypt/Decrypt section)
Drop this file into a GitHub repo and open via GitHub Pages.
Logo: uses local path uploaded in your session (/mnt/data/Screenshot.png).
If you prefer to embed the logo, replace the img src with a base64 data URL.
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zama Demo Testnet — v4 (No Encrypt/Decrypt)</title>
  <style>
    :root{
      --bg-start:#00111a;
      --bg-end:#041827;
      --card:#071a2a;
      --accent:#ffd400;
      --muted:#9aa6b2;
      --glass: rgba(255,255,255,0.03);
      --accent-dark:#f0b800;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;padding:0;color:#e6eef6}
    body{background:linear-gradient(180deg,var(--bg-start) 0%, var(--bg-end) 100%);min-height:100vh}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-bottom:1px solid rgba(255,255,255,0.02)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;object-fit:cover;border:2px solid rgba(0,0,0,0.15)}
    .title{font-weight:700;font-size:18px}
    .small{font-size:13px;color:var(--muted)}
    .container{max-width:1100px;margin:22px auto;display:flex;gap:18px;padding:10px}
    .left{flex:1;display:flex;flex-direction:column;gap:14px}
    .right{width:380px;display:flex;flex-direction:column;gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    .btn{background:var(--accent);color:#061320;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .area{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .row{display:flex;gap:8px;align-items:center}
    .actions{display:flex;gap:8px;margin-top:8px}
    .logbox{background:#020617;padding:10px;border-radius:8px;color:#bfe7ff;overflow:auto;height:220px;white-space:pre-wrap}
    .center{display:flex;align-items:center;justify-content:center;flex-direction:column}
    .footer{text-align:center;color:var(--muted);font-size:13px;margin-top:12px}

/* Welcome modal - larger + colorful */
    .modal-backdrop{position:fixed;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.55));display:flex;align-items:center;justify-content:center;z-index:200}
    .modal{background:linear-gradient(180deg,#071827 0%, #0b2740 100%);padding:28px;border-radius:16px;max-width:720px;border:2px solid rgba(255,255,255,0.03);box-shadow:0 20px 60px rgba(2,6,23,0.75);display:flex;gap:20px;align-items:center}
    .modal .left{flex:0 0 140px}
    .modal .left img{width:140px;height:140px;border-radius:14px;object-fit:cover;border:3px solid rgba(255,255,255,0.04)}
    .modal h2{margin:0 0 6px 0;font-size:26px}
    .modal p{color:var(--muted);margin:0 0 12px 0}
    .modal .cta{display:flex;gap:10px;margin-top:6px}

/* responsive */
    @media(max-width:900px){.container{flex-direction:column;padding:12px}.right{width:100%}.modal{flex-direction:column;text-align:center}.modal .left{margin-bottom:8px}}
  </style>
</head>
<body>

<!-- Welcome modal -->
<div id="welcome" class="modal-backdrop" role="dialog" aria-modal="true">
  <div class="modal" aria-labelledby="welcomeTitle">
    <div class="left">
      <!-- LOCAL LOGO PATH: the platform will map /mnt/data/Screenshot.png to a URL for you.
           If you upload logo to your repo, set src="./Screenshot.png" or "assets/logo.png" instead. -->
      <img src="/mnt/data/Screenshot.png" alt="logo">
    </div>
    <div style="flex:1">
      <h2 id="welcomeTitle">Welcome to the Zama Demo Testnet</h2>
      <p class="small">A live-feeling demo UI simulating wallet connect, faucet claims (one per wallet/email), swap flows, and transaction logs — for demo & community use only.</p>
      <div class="cta">
        <button id="startBtn" class="btn">Start Demo</button>
        <button id="skipBtn" class="btn ghost">Skip</button>
      </div>
      <div style="margin-top:10px" class="small">Project: <a href="https://docs.zama.org/protocol" target="_blank" style="color:#9ae6b4">Zama Protocol</a> • Created by <strong>@AmitKum955</strong></div>
    </div>
  </div>
</div>

<header class="topbar" role="banner">
  <div class="brand">
    <img src="/mnt/data/Screenshot.png" class="logo" alt="logo"/>
    <div>
      <div class="title">Zama Demo Testnet</div>
      <div class="small">Simulated demo — no real blockchain interactions</div>
    </div>
  </div>
  <div style="display:flex;gap:12px;align-items:center">
    <div class="small" id="netBadge">Network: zama-demo (Chain 9999)</div>
    <button id="connectBtn" class="btn">Connect Wallet</button>
  </div>
</header>

<main class="container" aria-live="polite">
  <section class="left">
    <div class="card">
      <h3>Wallet & Faucet</h3>
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="small">Address</div>
          <div id="walletAddr">Not connected</div>
        </div>
        <div>
          <div class="small">Balances</div>
          <div id="balances">tZAMA: 0 • tUSDC: 0</div>
        </div>
      </div>

      <div style="margin-top:10px" class="small">
        <label for="claimId">Name or Email (required to claim faucet once)</label><br/>
        <input id="claimId" class="area" placeholder="Enter your name or email"/>
      </div>

      <div class="actions" style="margin-top:10px">
        <button id="faucetZ" class="btn">Claim 100 tZAMA</button>
        <button id="faucetU" class="btn ghost">Claim 100 tUSDC</button>
        <button id="clearBtn" class="btn ghost">Clear Logs</button>
      </div>

      <div style="margin-top:8px" class="small">Faucet rule: one claim per wallet OR per name/email. Claims saved in your browser for demo purposes.</div>
    </div>

    <div class="card">
      <h3>Swap (Simple)</h3>
      <div class="small">Choose token to swap from and token to receive. Swap count per wallet is tracked. After swap you can optionally share a prepared post on X (Twitter).</div>

      <div style="display:flex;gap:8px;align-items:center;margin-top:10px" class="swap-form" aria-label="swap form">
        <label class="small" for="fromToken" style="display:none">From</label>
        <select id="fromToken" class="area" style="width:120px">
          <option value="ZAMA">tZAMA</option>
          <option value="USDC">tUSDC</option>
        </select>

        <label class="small" for="toToken" style="display:none">To</label>
        <select id="toToken" class="area" style="width:120px">
          <option value="USDC">tUSDC</option>
          <option value="ZAMA">tZAMA</option>
        </select>

        <input id="amount" type="number" min="0" step="0.1" placeholder="Amount" aria-label="amount" />
        <button id="swapBtn" class="btn">Swap</button>
      </div>

      <div style="margin-top:10px" class="small">
        <div>Exchange rate: <span id="rateDisplay">1 tZAMA = 1.2 tUSDC</span></div>
        <div>Swaps done (this wallet): <span id="swapCount">0</span></div>
        <div style="margin-top:8px">
          <label><input type="checkbox" id="shareApr" /> Share APR on X after swap</label>
        </div>
      </div>
    </div>

  </section>

  <aside class="right">
    <div class="card">
      <h3>MPC Nodes</h3>
      <div id="nodes" class="small">Loading nodes...</div>
      <div style="margin-top:8px" class="actions">
        <button id="refreshNodes" class="btn ghost">Refresh</button>
      </div>
    </div>

    <div class="card">
      <h3>Transactions / Logs</h3>
      <div id="lastTx" class="small">Last TX: -</div>
      <div style="margin-top:8px" class="logbox" id="logs">No logs yet.</div>
    </div>

    <div class="card center">
      <div class="small">Block Height</div>
      <div id="blockHeight" style="font-weight:700;font-size:18px">120000</div>
      <div style="margin-top:8px" class="small">Chain: zama-demo</div>
    </div>
  </aside>
</main>

<div class="footer">Demo built using <a href="https://docs.zama.org/protocol" target="_blank" style="color:#a5b4fc">Zama Protocol docs</a> as reference. Exported single-file for easy GitHub Pages deploy. Created by <strong>@AmitKum955</strong></div>

<script>
/* Demo v4 script (no encrypt/decrypt section). Uses localStorage for simple persistence.
   IMPORTANT: The logo src currently points to /mnt/data/Screenshot.png (uploaded in session).
   If hosting on GitHub, place the logo file in the repo root (Screenshot.png) and change src to "./Screenshot.png" */
const connectBtn = document.getElementById('connectBtn');
const walletAddrEl = document.getElementById('walletAddr');
const balancesEl = document.getElementById('balances');
const faucetZ = document.getElementById('faucetZ');
const faucetU = document.getElementById('faucetU');
const logsEl = document.getElementById('logs');
const clearBtn = document.getElementById('clearBtn');
const nodesEl = document.getElementById('nodes');
const refreshNodes = document.getElementById('refreshNodes');
const blockHeightEl = document.getElementById('blockHeight');
const startBtn = document.getElementById('startBtn');
const skipBtn = document.getElementById('skipBtn');
const welcome = document.getElementById('welcome');
const swapBtn = document.getElementById('swapBtn');
const fromToken = document.getElementById('fromToken');
const toToken = document.getElementById('toToken');
const amountInput = document.getElementById('amount');
const rateDisplay = document.getElementById('rateDisplay');
const lastTx = document.getElementById('lastTx');
const swapCountEl = document.getElementById('swapCount');
const shareAprCheckbox = document.getElementById('shareApr');
const claimIdInput = document.getElementById('claimId');

let wallet = null;
let balances = { ZAMA:0, USDC:0 };
let logs = [];
let blockHeight = 120000;
let rate = 1.2; // 1 ZAMA = 1.2 USDC default

function pushLog(obj){
  obj.time = new Date().toLocaleTimeString();
  logs.unshift(obj);
  renderLogs();
}

function renderLogs(){
  logsEl.textContent = logs.slice(0,200).map(l=>JSON.stringify(l,null,2)).join('\\n\\n');
  balancesEl.textContent = `tZAMA: ${balances.ZAMA} • tUSDC: ${balances.USDC}`;
  const lastConfirmed = logs.find(l=>l.event==='tx_confirmed' || l.event==='swap');
  lastTx.textContent = lastConfirmed ? ('Last TX: '+(lastConfirmed.tx || lastConfirmed.txHash || lastConfirmed.txId || '—')) : 'Last TX: -';
  swapCountEl.textContent = getSwapCount();
}

// localStorage helpers
function storageKeyForWallet(addr){ return 'demo_claims_wallet_' + addr; }
function storageKeyForEmail(id){ return 'demo_claims_id_' + id; }
function storageSwapKey(addr){ return 'demo_swap_count_' + addr; }
function storageBalancesKey(addr){ return 'demo_balances_' + addr; }

function getSwapCount(){
  if(!wallet) return 0;
  const k = storageSwapKey(wallet);
  return parseInt(localStorage.getItem(k) || '0', 10);
}
function incrementSwapCount(){
  if(!wallet) return;
  const k = storageSwapKey(wallet);
  const v = parseInt(localStorage.getItem(k) || '0',10)+1;
  localStorage.setItem(k, String(v));
  swapCountEl.textContent = v;
}

// wallet connect (fake)
connectBtn.addEventListener('click', ()=>{
  if(!wallet){
    wallet = '0x'+Math.random().toString(16).substr(2,12);
    walletAddrEl.textContent = wallet;
    connectBtn.textContent = 'Disconnect';
    pushLog({event:'wallet_connected', address:wallet});
    // load balances if previously saved
    const saved = localStorage.getItem(storageBalancesKey(wallet));
    if(saved){ balances = JSON.parse(saved); }
    renderLogs();
  } else {
    pushLog({event:'wallet_disconnected', address:wallet});
    wallet = null;
    walletAddrEl.textContent = 'Not connected';
    connectBtn.textContent = 'Connect Wallet';
    renderLogs();
  }
});

// faucet logic: one claim per wallet OR per name/email (stored in localStorage)
function canClaimForWallet(addr){
  const key = storageKeyForWallet(addr);
  return !localStorage.getItem(key);
}
function canClaimForId(id){
  const key = storageKeyForEmail(id);
  return !localStorage.getItem(key);
}
function markClaimForWallet(addr){
  const key = storageKeyForWallet(addr);
  localStorage.setItem(key, JSON.stringify({time: new Date().toISOString()}));
}
function markClaimForId(id){
  const key = storageKeyForEmail(id);
  localStorage.setItem(key, JSON.stringify({time: new Date().toISOString()}));
}

faucetZ.addEventListener('click', ()=>{
  const id = (claimIdInput.value || '').trim();
  if(!wallet && !id){ alert('Connect wallet or enter a name/email to claim'); return; }
  if(wallet && !canClaimForWallet(wallet)){ alert('This wallet already claimed faucet once.'); return; }
  if(id && !canClaimForId(id)){ alert('This name/email already claimed faucet once.'); return; }
  const amount = 100;
  balances.ZAMA = Math.round((balances.ZAMA + amount)*10000)/10000;
  pushLog({event:'faucet', token:'tZAMA', amount, by: wallet || id});
  if(wallet) markClaimForWallet(wallet);
  if(id) markClaimForId(id);
  if(wallet){ localStorage.setItem(storageBalancesKey(wallet), JSON.stringify(balances)); }
  renderLogs();
});

faucetU.addEventListener('click', ()=>{
  const id = (claimIdInput.value || '').trim();
  if(!wallet && !id){ alert('Connect wallet or enter a name/email to claim'); return; }
  if(wallet && !canClaimForWallet(wallet)){ alert('This wallet already claimed faucet once.'); return; }
  if(id && !canClaimForId(id)){ alert('This name/email already claimed faucet once.'); return; }
  const amount = 100;
  balances.USDC = Math.round((balances.USDC + amount)*10000)/10000;
  pushLog({event:'faucet', token:'tUSDC', amount, by: wallet || id});
  if(wallet) markClaimForWallet(wallet);
  if(id) markClaimForId(id);
  if(wallet){ localStorage.setItem(storageBalancesKey(wallet), JSON.stringify(balances)); }
  renderLogs();
});

// swap system with selectable tokens and swap count; shows tx id and option to share on X
swapBtn.addEventListener('click', ()=>{
  if(!wallet){ alert('Connect wallet first'); return; }
  const from = fromToken.value;
  const to = toToken.value;
  if(from === to){ alert('Select two different tokens'); return; }
  const amount = parseFloat(amountInput.value);
  if(!amount || amount<=0){ alert('Enter amount'); return; }
  const inToken = from === 'ZAMA' ? 'ZAMA' : 'USDC';
  const outToken = to === 'ZAMA' ? 'ZAMA' : 'USDC';
  const feePct = 0.005;
  if(balances[inToken] < amount){ alert('Insufficient balance'); return; }
  let received;
  if(inToken === 'ZAMA'){
    received = amount * rate * (1 - feePct);
  } else {
    received = (amount / rate) * (1 - feePct);
  }
  received = Math.round(received * 10000)/10000;
  balances[inToken] = Math.round((balances[inToken] - amount) * 10000)/10000;
  balances[outToken] = Math.round((balances[outToken] + received) * 10000)/10000;
  const tx = '0x' + Math.random().toString(16).substr(2,12);
  pushLog({event:'swap', from:inToken, to:outToken, amount, received, tx});
  incrementSwapCount();
  // persist balances
  if(wallet){ localStorage.setItem(storageBalancesKey(wallet), JSON.stringify(balances)); }
  renderLogs();
  // share on X if checked
  const projectLink = 'https://docs.zama.org/protocol';
  const createdBy = '@AmitKum955';
  if(shareAprCheckbox.checked){
    const aprExample = "APR: 12.5%";
    const text = encodeURIComponent(`Tried the Zama Demo Testnet! Swapped ${amount} ${inToken} → ${received} ${outToken}. ${aprExample} Learn more: ${projectLink} Created by ${createdBy}`);
    window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
  }
  alert(`Swapped ${amount} ${inToken} → ${received} ${outToken} (tx ${tx})`);
});

// nodes simulation
function renderNodes(){
  const count = 5;
  const arr = [];
  for(let i=1;i<=count;i++){
    const on = Math.random()>0.08;
    arr.push({id:i, status:on?'ONLINE':'OFFLINE'});
  }
  nodesEl.innerHTML = arr.map(n=>`Node ${n.id}: <strong style="color:${n.status==='ONLINE'?'#6ee7b7':'#ff6b6b'}">${n.status}</strong>`).join('<br>');
  pushLog({event:'nodes_refreshed', nodes:arr.map(n=>n.status)});
}
refreshNodes.addEventListener('click', renderNodes);

// block height ticker
setInterval(()=>{ blockHeight += Math.floor(Math.random()*3); blockHeightEl.textContent = blockHeight; },1500);

// clear logs
clearBtn.addEventListener('click', ()=>{ logs = []; renderLogs(); pushLog({event:'logs_cleared'}); });

// welcome controls
startBtn.addEventListener('click', ()=>{ welcome.style.display = 'none'; pushLog({event:'demo_started'}); });
skipBtn.addEventListener('click', ()=>{ welcome.style.display = 'none'; pushLog({event:'demo_skipped'}); });

// initial render
renderNodes();
renderLogs();
pushLog({event:'demo_loaded'});

// keyboard: W toggles welcome
document.addEventListener('keydown', (e)=>{ if(e.key && e.key.toLowerCase()==='w'){ welcome.style.display = welcome.style.display === 'none' ? 'flex' : 'none'; } });
</script>

</body>
</html>
